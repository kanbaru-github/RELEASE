<div class="container"></div>
  <div class="row">
    <h5 class="two-line-heading">マイページ</h5>
  </div>

  <div class="row mt-3">
    <div class="col-10 d-flex justify-content-end">
      <div>共感数</div>
      <div>応援数</div>
    </div>
  </div>

  <div class="row mt-2">
    <div class="col-10">
      <table class="table table-bordered">
        <tr>
          <th>メールアドレス</th>
          <th class="w-75"><%= @customer.email %><%= link_to "編集する", edit_customer_path, class:"btn btn-success float-right" %></td>
        </tr>
        <tr>
          <th>非表示にした投稿</th>
          <th><%= link_to @customer.mutings.count, customer_mutings_path(@customer) %></th>
        </tr>
      </table>
    </div>
  </div>

  <div class="row">
    <h3>投稿数の前日比・前週比</h3>
    <div class="table_width">
      <table class='table table-bordered'>
        <thead>
          <tr>
            <th>今日の投稿数</th>
            <th>前日の投稿数</th>
            <th>前日比</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><%= @today_post.count %></td>
            <td><%= @yesterday_post.count %></td>
            <td>
              <% if @yesterday_post.count == 0 %>
                前日の投稿が0のため計算できません
              <% else %>
                <% @the_day_before =   @today_post.count / @yesterday_post.count.to_f  %>
                <%= (@the_day_before * 100).round %>%
              <% end %>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="table_width">
      <table class='table table-bordered'>
        <thead>
          <tr>
            <th>今週の投稿数</th>
            <th>前週の投稿数</th>
            <th>前週比</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><%= @this_week_post.count %></td>
            <td><%= @last_week_post.count %></td>
            <td>
              <% if @last_week_post.count == 0 %>
                前週の投稿が0のため計算できません
              <% else %>
                <% @the_week_before = @this_week_post.count / @last_week_post.count.to_f  %>
                <%= (@the_week_before * 100).round %>%
              <% end %>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="row">
    <h4>7日間分の投稿数</h4>
    <table class='table table-bordered'>
      <thead>
        <tr>
          <th>６日前</th>
          <th>５日前</th>
          <th>４日前</th>
          <th>３日前</th>
          <th>２日前</th>
          <th>１日前</th>
          <th>今日</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><%= @posts.created_6day_ago.count %></td>
          <td><%= @posts.created_5day_ago.count %></td>
          <td><%= @posts.created_4day_ago.count %></td>
          <td><%= @posts.created_3day_ago.count %></td>
          <td><%= @posts.created_2day_ago.count %></td>
          <td><%= @posts.created_yesterday.count %></td>
          <td><%= @posts.created_today.count %></td>
        </tr>
      </tbody>
    </table>
    <canvas id="myLineChart"></canvas>
    <!--canvas要素は、グラフィックなどが描写可能なビットマップキャンバスを提供-->
    <script>
      $(document).on('turbolinks:load', function() {
        // Ajaxによるページ遷移の高速化のためのライブラリ
        // ページの読み込み時	window.onLoadの代替として利用
        var ctx = document.getElementById("myLineChart");
        // canvas要素（id = myLineChart） を取得し、変数 ctx に入力
        var myLineChart = new Chart(ctx, {
          // 描画するグラフを、new Chart()によって設定
          type: 'line',
          // 描画するグラフの種類
          data: {
            labels: ['6日前', '5日前', '4日前', '3日前', '2日前', '1日前', '今日'],
            datasets: [
              {
                label: '投稿の数',
                data: [<%= @posts.created_6day_ago.count %>, <%= @posts.created_5day_ago.count %>, <%= @posts.created_4day_ago.count %>, <%= @posts.created_3day_ago.count %>, <%= @posts.created_2day_ago.count %>, <%= @posts.created_yesterday.count %>, <%= @posts.created_today.count %>],
                borderColor: "rgba(0,0,255,1)",
                // 折れ線グラフの線の色
                backgroundColor: "rgba(0,0,0,0)"
                // 線の下の塗りつぶしの色
              }
            ],
          },
          options: {
            title: {
              display: true,
              // タイトル表示の可否
              text: '7日間の投稿数の比較'
            },
            scales: {
              // グラフ軸の詳細（最大値・最小値・刻み幅など）
              yAxes: [{
                // y軸の設定
                ticks: {
                  // 項目を設定
                  suggestedMax: 10,
                  // 軸の最大値
                  suggestedMin: 0,
                  // 軸の最大値
                  stepSize: 1,
                  // 軸の刻み幅
                  callback: function(value, index, values){
                    // 軸のラベル
                    return  value
                    // 戻り値(プログラムや関数からの返却値)
                  }
                }
              }]
            },
          }
        });
      });
    </script>
  </div>

  <%= form_with url: customer_search_path(@customer), method: :get do |f| %>
    <%= f.date_field :created_at %>
    <!--年、月、日等のテキストフィールドが１つにまとまっており、カレンダー入力ができるようになっている-->
    <%= f.submit '検索', class: 'btn btn-primary'  %>
  <% end %>

  <div id="search_result">
    <% if @search_post.present? %>
    <!--存在する場合-->
      <%= render 'search', search_post: @search_post %>
    <% end %>
  </div>

  <div class="row">
    <h2>YOUR POSTS</h2>
    <table class='table table-hover'>
      <thead>
        <tr>
          <th>投稿日時</th>
          <th>IMAGE</th>
          <th>TEXT</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @posts.each do |post| %>
          <tr>
            <th><%= post.created_at.strftime("%Y/%m/%d %H:%M:%S") %></th>
            <th><%= attachment_image_tag(post, :image, :fill, 50, 50, fallback: "no-image.jpg") %></th>
            <th><%= post.text %></th>
            <td><%= link_to '編集する', edit_post_path(post), class: "btn btn-sm btn-success" %></td>
            <td><%= link_to '削除する', post_path(post), method: :delete, data: { confirm: '本当に消しますか？' }, class: "btn btn-sm btn-danger" %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

</div>